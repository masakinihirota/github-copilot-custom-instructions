# 使い方

* このREADME.mdおよびsettings.json以外のファイルを、GitHub Copilotを使用するプロジェクトのフォルダにコピーしてください。
* settings.jsonはVSCodeの設定に挿入します。

* 指示書を用意した後は、GitHub Copilotに指示書を指定(ドラッグアンドドロップ等)して、プロンプトファイルを作ります。

## 確認、チェック、範囲

### 確認

指示書ファイルの存在確認
GitHub Copilotはどの指示書を読むようにしているか？
リスト化してもらう。

### チェック

重複チェック

無効チェック



### 範囲

指示書は思いついたことを書くとダラダラ長くなります。
GitHub Copilotにどの指示書の範囲が適切かの判断をしてもらいます。



# 指示書(＝プロンプト)と、その指示書を書く指示書の書き方(＝メタプロンプト)

プロンプトもメタプロンプトもAIに直接尋ねます。
書き方や具体例などを交えて教えてくれます。



## repomix

現在のリポジトリのファイルを1つのテキストファイルします。
GitHub Copilotやその他LLMに渡すときに便利です。

これはリポジトリ全体を事前スキャンし、GitHub Copilotがコードベースの文脈を把握した状態でサジェストや修正をしやすくなるためのツールです。

例えば、コードを実装後に👇毎回叩いて、コードレビューをしてもらいます。

リポジトリの直下で `npx repomix` を叩くと repomix-output.txt というファイルが出来上がります。
repomixは実装終了ごとに更新するよう自動化するか、手動でrepomixを更新します。



### AIへの指示の具体例

`repomix-output.txt` を読み込ませた上で、👇のような指示を具体的に与えます。

* 「このコードの可読性を向上させるための提案をしてください。特に変数名や関数名で改善点があれば教えてください。」
* 「このコードには技術的負債となりうる箇所はありますか？もしあれば、具体的な場所と理由を教えてください。」
* 「セキュリティ上の懸念点があれば指摘してください。特に外部からの入力処理について注意深く見てください。」
* 「このコードに対して、どのようなテストを追加すべきでしょうか？テストケースのアイデアをいくつか提案してください。」
* 「このコードの設計について、改善点やより良いアプローチがあれば教えてください。」
* 「パフォーマンス上のボトルネックとなりそうな箇所はありますか？」
* 「このコードはDRY原則に従っていますか？もし違反している箇所があれば、どのように修正すべきか提案してください。」



## コーディングルール

指示書に書くコーディングルールは毎回AIに調整をしてもらっています。
VSCodeのsettings.jsonに書く指示はAIに調整してもらうのは少々苦労するので他の指示書で微調整をしています。

## プロンプトファイル

プロンプトファイル＝実装書

.github/prompts/ディレクトリ内に、拡張子.prompt.mdのファイルを作成します。

実装時に、設計書をタスク分解した全タスクをタスクリストに登録します。
そのタスクリストからタスクを一つ取り出しプロンプトファイルを作ります。

プロンプトファイルを使ってGitHub Copilotにどのように実装するかを詰めていきます。
そして対話していって、詳細な部分まで書きます。

例
必要な各指示書を読ませます。
実現したい機能や目的を、具体的に記述します。

使用ツールプログラミング言語、フレームワーク、ライブラリを指定します。
参考コード、参考資料を提示します。
入力、出力、処理内容、表示内容を詳細に記述します。
エラー処理や例外処理に関する要件も記述します。
パフォーマンスやセキュリティに関する要件も考慮します。

### プロンプトファイル作成例

ユーザー認証機能

```auth.prompt.md
# 機能：ユーザー認証機能

## 説明

ユーザー名とパスワードを使用してユーザー認証を行う機能を作成してください。

## 要件

* ユーザー名とパスワードはデータベースに保存されていること。
* 認証に成功した場合、ユーザーIDを返すこと。
* 認証に失敗した場合、エラーメッセージを表示すること。

## コード構造

* ユーザー認証を行う`authenticateUser`関数を作成してください。
* データベースへのアクセスは`Database`クラスを使用してください。

## テスト

* 正しいユーザー名とパスワードで認証できること。
* 誤ったユーザー名またはパスワードで認証できないこと。

## コーディング規約

* 関数名、変数名はわかりやすく命名すること。
* エラー処理を適切に行うこと。

```



プロンプトファイルの充実度が満足まで出来たら、
そのプロンプトファイルを利用してコードを生成してもらいます。

コード生成後
テスト

GitHub Copilotによるレビュー
レビュー方針にしたがって微調整

GitHubにコミット時に、Biome等でソースコードの整形
GitHubにpusuする前にビルドの動作確認
GitHubにpush、サーバーにデプロイ



### レビュー方針

#### 基本的なコード品質

* 可読性
* 保守性
* 効率性

#### 技術的負債

* 将来的な問題の可能性
* 命名の不統一
* 非推奨の機能やライブラリの使用
* 未解決の課題やTODOコメント

#### セキュリティ

* 入力の検証
* エラーハンドリング
* 権限管理

#### テスト

* テストの網羅性
* テストの品質
* テスト容易性
* テストされていない箇所

#### その他

* 設計の妥当性
* 規約との適合
* 依存関係



## 指示書（プロンプト）とメタプロンプト

* 指示書（プロンプト）

GitHub Copilot（または他の大規模言語モデル）に対して、特定のタスクを実行させるための命令や質問。
例：「特定の機能のコードを生成してください」「このコードを修正してください」など。

* メタプロンプト

指示書（プロンプト）自体を生成したり、指示書（プロンプト）の形式や内容を制御したりするためのプロンプト。
「AIにどのように指示すべきか」を指示するためのプロンプト。
例：「あなたは経験豊富なプログラマーです。与えられた仕様に基づいて、TypeScriptの関数を生成してください。指示書は箇条書きで記述し、具体的な例を含めてください。」

戦略として、GitHub Copilotに渡すプロンプトを作るために、メタプロンプトに詳細な指示を書きます。

## メタプロンプトの詳細な指示の例

以下に、メタプロンプトに詳細な指示を書く例をいくつか示します。

* 役割の定義
    * 「あなたは、経験豊富なTypeScriptプログラマーです。与えられた仕様に基づいて、効率的で読みやすいTypeScriptコードを生成してください。」
* 出力形式の指定
    * 「生成するコードには、適切なコメントとドキュメンテーションを含めてください。関数やクラスには、その目的と使い方を説明するdocstringを記述してください。」
    * 「コードはコーディング規約に従ってください。」
* 制約条件の指定
    * 「生成するコードは、指定されたライブラリのみを使用してください。外部ライブラリを使用する場合は、事前に承認を得てください。」
    * 「コードの実行速度は、〇〇ミリ秒以内に収まるようにしてください。」
* テストコードの生成
    * 「生成するコードには、単体テストコードを自動的に生成してください。テストコードは、pytestフレームワークを使用してください。」
* .github/copilot-instructions.mdの活用
    * プロジェクト全体で適応させたいルールは、こちらに記述します。
    * 「このリポジトリで生成されるコードは、常に〇〇のコーディング標準に従ってください。」
    * 「セキュリティ上の脆弱性を避けるため、〇〇のライブラリの使用は避けてください。」

## プロンプトファイルの活用

* 目的や機能ごとにプロンプトファイルを作成し、GitHub Copilotに読み込ませることで、より柔軟なコーディングが可能になります。

メタプロンプトに詳細な指示を書くことで、GitHub Copilotの能力を最大限に引き出し、より効率的かつ高品質なコーディングを実現できます。



## メモリーバンク

メモリーバンクを使う運用をしたい場合Clineを使ったほうがいいです。
GitHub Copilot Agent modeには、Clineのような自動承認モードがないため、メモリーバンクのような機能を使用する場合も、ファイルの読み書き、安全なコマンドの実行、ブラウザの使用、MCPサーバーの使用などの許可を、ユーザー自身が指示し承認する必要があります。
このリポジトリで提供するGitHub Copilot用のメモリーバンクは、自然言語による指示を通じて、ソフトウェア的に関連するファイルを考慮するように設計されています。
便利さを取るか、安全を取るかの判断です。



---

# GitHub Copilot Agent mode、Cline、Cursor、Windsurf

中・大規模プロジェクトでは、関連性の低いファイルまで考慮してしまうGitHub Copilot Agent modeに対し、Clineは物理的に関連するソースコードのみを読み込むように設計されてます。
また、ClineはAST（抽象構文木）を使用することで、コードの文法的な構造を容易に理解し、プログラムで処理できます。
さらに、Clineは必要最小限の情報のみを逐次取得するアーキテクチャを採用しています。

これらのツールの間には、プロジェクトの規模が大きくなるほど顕著な差が現れます。

repomix、uithub等のツールを使うと利便性が向上します。

AIエディタであるCursorやWindsurfは、継続的にコード全体を認識し、インデックス化します。

## 各ツールの違い

AIが読み込む情報に対して

* ソースコード全体をインデックス化しているツール Cursor、Windsurf
* 必要なソースコードをASTで解析するツール Cline
* ソースコード全体に自然言語で指示するツール GitHub Copilot Agent mode

いずれのツールを使用するにしても、現在のAIの能力では、詳細な設計を行い、タスクを小さな単位に分割し、それらをAIに読み込ませて、コンポーネント単位でコードを作成していくのが最適解です。



---

# 用語集

* AST（抽象構文木） コードの文法的な構造を木構造で表現したもの。プログラムがコードを理解し、処理するために使用されます。
* 計画的かつ反復的な開発プロセス 事前に計画を立て、小さなサイクルを繰り返しながら開発を進めるアプローチ。アジャイル開発などが該当します。
* 設計書 Webアプリケーションの全体像や各機能の詳細を記述したドキュメント。要件定義、画面設計、データベース設計などが含まれます。
* タスク分解 設計書に基づいて、開発に必要な作業をより小さな単位に分割すること。
* タスクリストファイル (task-list.md) 分解されたタスクの一覧を記録したファイル。各タスクの進捗状況などを管理します。
* 全体の指示書 (copilot-instructions.md) プロジェクト全体に共通するルール、技術スタック、アーキテクチャなどを定義するファイル。
* 個別の指示書 特定の作業フェーズ（コード生成、コミットメッセージ、レビュー、テストなど）に関する詳細なルールを定めるファイル。
* プロンプトファイル 1つのタスク（1機能）の実装に関する具体的な詳細情報を記述したファイル。
* メモリーバンク GitHub Copilotがセッション間でプロジェクトのコンテキストを維持するための仕組み。複数のマークダウンファイルでプロジェクト情報を記録し、AIが参照できるようにします。
* 技術スタック プロジェクトで使用する技術の組み合わせ（プログラミング言語、フレームワーク、ライブラリなど）。
* コーディング規約 プロジェクト全体で一貫したコード品質を保つためのルール（命名規則、コメントの書き方、推奨されるプログラミングパターンなど）。
* コロケーション 関連するファイルを近くに配置する開発手法。ここでは、コンポーネントのテストコードを同じフォルダに配置することを指します。
* ユニットテスト 個々のコンポーネントや関数が意図した通りに動作するかを検証するテスト。
* 統合テスト 複数のコンポーネントやシステムが連携して正しく動作するかを検証するテスト。
* 技術的負債 将来的に追加の作業が必要になる、現在の不完全な設計や実装。コードの重複、複雑すぎるコードなどが該当します。
* コードレビュー 他の開発者が作成したコードをチェックし、品質や潜在的な問題を評価するプロセス。
* MCP (Model Context Protocol) GitHub Copilot Agent modeで外部サービスと連携するための設定プロトコル。
* GitHub Copilot Agent mode GitHub Copilotの機能の一つで、外部ツールやサービスと連携してより高度な支援を行うモード。

# 参考資料

* Cline / Roo-Codeにおけるコード理解と新規・保守タスクの現状 [https//zenn.dev/tesla/articles/33d196d17bf3bb](https//zenn.dev/tesla/articles/33d196d17bf3bb)


---







---

# Cursor rules

Always
常に適用されるルール

Auto Attached
拡張子にマッチしたファイルに適用されるルール
*.tsx

Agent Requested
AIが必要だと判断した時、採用するルール

Manual
手動


## AI ルール

このファイルを参照したら、このファイル名を発言すること

---
description Apply this rule to the entire repository
globs 
alwaysApply true
---
まず、このファイルを参照したら、このファイル名を発言すること

あなたは高度な問題解決能力を持つAIアシスタントです。以下の指示に従って、効率的かつ正確にタスクを遂行してください。

まず、ユーザーから受け取った指示を確認します：
<指示>
{{instructions}}
<!-- このテンプレート変数はユーザーの入力プロンプトに自動置換されます -->
</指示>

この指示を元に、以下のプロセスに従って作業を進めてください：

---

1. 指示の分析と計画
   <タスク分析>
   - 主要なタスクを簡潔に要約してください。
   - 記載された**守るべきルールのディレクトリ/ファイル**を必ずチェックしてください。
   - 重要な要件と制約を特定してください。
   - 潜在的な課題をリストアップしてください。
   - タスク実行のための具体的なステップを詳細に列挙してください。
   - それらのステップの最適な実行順序を決定してください。
   
   ### 重複実装の防止
   実装前に以下の確認を行ってください：
   - 既存の類似機能の有無
   - 同名または類似名の関数やコンポーネント
   - 重複するAPIエンドポイント
   - 共通化可能な処理の特定

   このセクションは、後続のプロセス全体を導くものなので、時間をかけてでも、十分に詳細かつ包括的な分析を行ってください。
   </タスク分析>

---

2. タスクの実行
   - 特定したステップを一つずつ実行してください。
   - 各ステップの完了後、簡潔に進捗を報告してください。
   - 実装時は以下の点に注意してください：
     - 適切なディレクトリ構造の遵守
     - 命名規則の一貫性維持
     - 共通処理の適切な配置

---

3. 品質管理と問題対応
   - 各タスクの実行結果を迅速に検証してください。
   - エラーや不整合が発生した場合は、以下のプロセスで対応してください：
     a. 問題の切り分けと原因特定（ログ分析、デバッグ情報の確認）
     b. 対策案の作成と実施
     c. 修正後の動作検証
     d. デバッグログの確認と分析
   
   - 検証結果は以下の形式で記録してください：
     a. 検証項目と期待される結果
     b. 実際の結果と差異
     c. 必要な対応策（該当する場合）

---

4. 最終確認
   - すべてのタスクが完了したら、成果物全体を評価してください。
   - 当初の指示内容との整合性を確認し、必要に応じて調整を行ってください。
   - 実装した機能に重複がないことを最終確認してください。

---

5. 結果報告
   以下のフォーマットで最終的な結果を報告してください：
   ```markdown
   # 実行結果報告

   ## 概要
   [全体の要約を簡潔に記述]

   ## 実行ステップ
   1. [ステップ1の説明と結果]
   2. [ステップ2の説明と結果]
   ...

   ## 最終成果物
   [成果物の詳細や、該当する場合はリンクなど]

   ## 課題対応（該当する場合）
   - 発生した問題と対応内容
   - 今後の注意点

   ## 注意点・改善提案
   - [気づいた点や改善提案があれば記述]
   ```
   
---

6. **守るべきルールのディレクトリ/ファイル**

   - ./cursor/rules/dev-rules/*.mdc 
   - 上記ファイルのルールを厳守してください。

---

## 重要な注意事項

- 不明点がある場合は、作業開始前に必ず確認を取ってください。
- 重要な判断が必要な場合は、その都度報告し、承認を得てください。
- 予期せぬ問題が発生した場合は、即座に報告し、対応策を提案してください。
- **明示的に指示されていない変更は行わないでください。** 必要と思われる変更がある場合は、まず提案として報告し、承認を得てから実施してください。
- **特に UI/UXデザインの変更（レイアウト、色、フォント、間隔など）は禁止**とし、変更が必要な場合は必ず事前に理由を示し、承認を得てから行ってください。
- **技術スタックに記載のバージョン（APIやフレームワーク、ライブラリ等）を勝手に変更しないでください。** 変更が必要な場合は、その理由を明確にして承認を得るまでは変更を行わないでください。

---

以上の指示に従い、確実で質の高い実装を行います。指示された範囲内でのみ処理を行い、不要な追加実装は行いません。不明点や重要な判断が必要な場合は、必ず確認を取ります。
